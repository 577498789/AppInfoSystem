<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.seventeen.appinfo.mapper.AppVersionMapper">
	
	<select id="findAppVersionsByAppId" resultType="AppVersion">
		SELECT * 
		FROM 
		app_version v 
		INNER JOIN (SELECT id AS appId,APKName AS appName  FROM app_info) i ON v.`appId` = i.appId
		INNER JOIN (SELECT valueId,valueName AS publishStatusName FROM data_dictionary WHERE typeCode="PUBLISH_STATUS") s ON v.`publishStatus` = s.valueId 
		WHERE v.`appId` = #{appId} order by id
	</select>
	<select id="findAppVersionsById" resultType="AppVersion">
		SELECT * 
		FROM 
		app_version v 
		INNER JOIN (SELECT id AS appId,APKName AS appName  FROM app_info) i ON v.`appId` = i.appId
		INNER JOIN (SELECT valueId,valueName AS publishStatusName FROM data_dictionary WHERE typeCode="PUBLISH_STATUS") s ON v.`publishStatus` = s.valueId 
		WHERE v.`id` = #{id}
	</select>
		
	<insert id="addAppVersion" >
<!-- 		<selectKey resultType="java.lang.long" keyProperty="id" order="AFTER">
			select last_insert_id()
		</selectKey> -->
	
		insert into app_version values(null,#{ver.appId},#{ver.versionNo},#{ver.versionInfo},#{ver.publishStatus},#{ver.downloadLink},#{ver.versionSize},#{ver.createdBy},#{ver.creationDate},#{ver.modifyBy},#{ver.modifyDate},#{ver.apkLocPath},#{ver.apkFileName})
	</insert>
	<update id="modifyAppVersion">
		UPDATE app_version 
		SET
		modifyBy = 1
		,modifyDate = NOW()
		<if test="versionInfo !=null and versionInfo !=''">
			,versionInfo = "1231321313223"
		</if>
		<if test="downloadLink !=null and downloadLink !=''">
			,downloadLink = "1231321313223"
		</if>
		<if test="apkFileName !=null and apkFileName !=''">
			,apkFileName = "1231321313223"
		</if>
		<if test="versionNo !=null and versionNo !=''">
			,versionNo = "1231321313223"
		</if>
		<if test="versionSize !=null and versionSize !=''">
			,versionSize = "1231321313223"
		</if>

		where id = #{id}
	</update>
	<delete id="deleteAppVersionsByAppId">
		delete from app_version where appId = #{appId}
	</delete>
</mapper>